<?xml version="1.0" encoding="UTF-8" ?>
<templates id="tmp" xml:space="preserve">
        <!-- MessageView template for displaying a single mail message -->
    <t t-name="MessageView" owl="1">
        <div class="outlook-email-viewer" t-ref="root-mail" style="background: #ffffff; height: 100%; display: flex; flex-direction: column; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
            
            <!-- Email Header Section -->
            <div class="email-header" style="background: #fafafa; border-bottom: 1px solid #e1e1e1; padding: 20px 24px;">
                
                <!-- Back Button -->
                <div class="back-button" style="margin-bottom: 16px;">
                    <button t-on-click="goBack" class="btn-back" style="background: transparent; border: 1px solid #8a8886; padding: 8px 16px; border-radius: 2px; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                        ‚Üê Back
                    </button>
                </div>
                
                <!-- Subject Line -->
                <div class="subject-line" style="margin-bottom: 16px;">
                    <h1 style="font-size: 24px; font-weight: 600; color: #323130; margin: 0; line-height: 1.3;">
                        <span t-out="props.mail.subject || 'No Subject'"/>
                    </h1>
                </div>
                
                <!-- Email Meta Information -->
                <div class="email-meta" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                    <div class="sender-info" style="display: flex; align-items: center;">
                        <!-- Avatar -->
                        <div class="sender-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: #0078d4; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                            <span style="color: white; font-weight: 600; font-size: 16px;" t-out="(props.mail.email_from || 'Unknown').charAt(0).toUpperCase()"/>
                        </div>
                        <div class="sender-details">
                            <div class="sender-name" style="font-weight: 600; color: #323130; font-size: 14px;">
                                <span t-out="props.mail.email_from || 'Unknown Sender'"/>
                            </div>
                            <div class="recipient-info" style="color: #605e5c; font-size: 13px; margin-top: 2px;">
                                To: <span t-out="props.mail.email_to || 'Unknown Recipient'"/>
                            </div>
                        </div>
                    </div>
                    
                    <div class="email-timestamp" style="text-align: right;">
                        <div style="color: #605e5c; font-size: 13px;">
                            <span t-out="formatDateTime(props.mail.message_date || props.mail.create_date)"/>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <!-- Email Content Section -->
            <div class="email-content" style="flex: 1; padding: 24px; overflow-y: auto; background: #ffffff;">
                <div class="message-body" style="font-size: 14px; line-height: 1.6; color: #323130; max-width: 100%; word-wrap: break-word;">
                    <t t-out="html_content"/>
                </div>
                
                <!-- Attachments Section -->
                <div t-if="Object.keys(state.attachments).length > 0" class="attachments-section" style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #e1e1e1;">
                    <h3 style="font-size: 16px; font-weight: 600; color: #323130; margin: 0 0 16px 0;">
                        üìé Attachments (<span t-out="Object.keys(state.attachments).length"/>)
                    </h3>
                    
                    <div class="attachments-grid" style="display: flex; flex-wrap: wrap; gap: 16px;">
                        <t t-foreach="state.attachments" t-as="data" t-key="data_index">
                            
                            <!-- Image Attachments -->
                            <div t-if="data.mimetype == 'image/jpeg' ||  data.mimetype == 'image/png' ||  data.mimetype == 'image/gif' ||  data.mimetype == 'image/svg+xml' ||  data.mimetype == 'image/webp'" 
                                 class="image-attachment" style="border: 1px solid #e1e1e1; border-radius: 4px; overflow: hidden; background: #fafafa; cursor: pointer; transition: box-shadow 0.2s;" 
                                 t-on-click="() => this.onClickImage(data.attachment)">
                                <div class="image-preview" style="position: relative;">
                                    <img style="width: 200px; height: 150px; object-fit: cover;" t-att-src="'data:image/png;base64,'+data.datas" alt="Image attachment"/>
                                    <div class="download-overlay" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                        ‚¨á
                                    </div>
                                </div>
                                <div style="padding: 12px; font-size: 13px; color: #605e5c;">
                                    <span t-out="data.name"/>
                                </div>
                            </div>
                            
                            <!-- PDF Attachments -->
                            <div t-if="data.mimetype == 'application/pdf'" 
                                 class="pdf-attachment" style="border: 1px solid #e1e1e1; border-radius: 4px; background: #fafafa; padding: 16px; width: 280px; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: box-shadow 0.2s;"
                                 t-on-click="() => this.onClickImage(data.attachment)">
                                <div class="pdf-icon" style="width: 48px; height: 48px; background: #d13438; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">
                                    PDF
                                </div>
                                <div class="pdf-details" style="flex: 1;">
                                    <div style="font-weight: 600; color: #323130; font-size: 14px; margin-bottom: 4px;">
                                        <span t-out="data.name"/>
                                    </div>
                                    <div style="color: #605e5c; font-size: 13px;">
                                        PDF Document
                                    </div>
                                </div>
                                <div class="download-icon" style="color: #0078d4; font-size: 16px;">
                                    ‚¨á
                                </div>
                            </div>
                            
                        </t>
                    </div>
                </div>
            </div>
            
        </div>
    </t>
</templates>
